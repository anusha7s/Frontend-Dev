<!DOCTYPE html>
<html>
<head>
  <title>Employee Status Dashboard</title>
  <style>
    body { font-family: Arial; padding: 30px; background: #f0f2f5; }
    table { width: 100%; border-collapse: collapse; background: white; }
    th, td { padding: 15px; text-align: left; border-bottom: 1px solid #ddd; }
    .switch { position: relative; display: inline-block; width: 60px; height: 34px; }
    .switch input { opacity: 0; width: 0; height: 0; }
    .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
    .slider:before { position: absolute; content: ""; height: 26px; width: 26px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
    input:checked + .slider { background-color: #2196F3; }
    input:checked + .slider:before { transform: translateX(26px); }
  </style>
</head>
<body>
  <div class="container">
    <h1>Employee Status Dashboard</h1>
    <table id="employeeTable">
      <thead><tr><th>Name</th><th>Status</th><th>Toggle</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const API = 'http://localhost:3002/employees';

    function loadEmployees() {
      const xhr = new XMLHttpRequest();
      xhr.open('GET', API);
      xhr.onload = function() {
        if (xhr.status === 200) {
          const employees = JSON.parse(xhr.responseText);
          const tbody = document.querySelector('#employeeTable tbody');
          tbody.innerHTML = '';
          employees.forEach(emp => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${emp.name}</td>
              <td><strong>${emp.status}</strong></td>
              <td>
                <label class="switch">
                  <input type="checkbox" ${emp.status === 'active' ? 'checked' : ''} 
                         data-id="${emp.id}" onchange="toggleStatus(this, ${emp.id})">
                  <span class="slider"></span>
                </label>
              </td>
            `;
            tbody.appendChild(row);
          });
        }
      };
      xhr.send();
    }

    function toggleStatus(checkbox, id) {
      const newStatus = checkbox.checked ? 'active' : 'inactive';
      const oldStatus = checkbox.checked ? 'inactive' : 'active';

      const xhr = new XMLHttpRequest();
      xhr.open('PATCH', `${API}/${id}`);
      xhr.setRequestHeader('Content-Type', 'application/json');
      
      xhr.onload = function() {
        if (xhr.status !== 200) {
          checkbox.checked = !checkbox.checked;
          alert('Failed to update status!');
        }
      };

      xhr.onerror = function() {
        checkbox.checked = !checkbox.checked;
        alert('Network error!');
      };

      xhr.send(JSON.stringify({ status: newStatus }));
    }

    loadEmployees();
  </script>
</body>
</html>